<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Employee Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 15px; border: none; }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-secondary">üë®‚Äçüíº Employee Manager</h2>
                <button class="btn btn-primary btn-lg shadow-sm" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
                    + –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>

            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" class="ps-4">ID</th>
                                <th scope="col">–ò–º—è –§–∞–º–∏–ª–∏—è</th>
                                <th scope="col">Email</th>
                                <th scope="col">–û—Ç–¥–µ–ª</th>
                                <th scope="col" class="text-end pe-4">–ó–∞—Ä–ø–ª–∞—Ç–∞ ($)</th>
                            </tr>
                        </thead>
                        <tbody id="employee-table-body">
                            </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="addEmployeeModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="addEmployeeForm">
            <div class="mb-3">
                <label class="form-label">–ò–º—è</label>
                <input type="text" class="form-control" id="firstName" required>
            </div>
            <div class="mb-3">
                <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" class="form-control" id="lastName" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
            </div>
            <div class="mb-3">
                <label class="form-label">–û—Ç–¥–µ–ª</label>
                <input type="text" class="form-control" id="department" value="IT">
            </div>
            <div class="mb-3">
                <label class="form-label">–ó–∞—Ä–ø–ª–∞—Ç–∞</label>
                <input type="number" class="form-control" id="salary" value="1000">
            </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <button type="button" class="btn btn-primary" onclick="createEmployee()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<script>
    const API_URL = 'http://localhost:8080/employees';

    // 1. –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (GET)
    async function loadEmployees() {
        try {
            let response = await fetch(API_URL);
            if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
            let employees = await response.json();
            renderTable(employees);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
        }
    }

    // 2. –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
    function renderTable(data) {
        let tableBody = document.getElementById('employee-table-body');
        tableBody.innerHTML = ''; // –ß–∏—Å—Ç–∏–º —Ç–∞–±–ª–∏—Ü—É
        
        data.forEach(e => {
            let row = `
                <tr>
                    <td class="ps-4 fw-bold text-secondary">#${e.id}</td>
                    <td><div class="fw-bold text-dark">${e.firstName} ${e.lastName}</div></td>
                    <td class="text-muted">${e.email}</td>
                    <td><span class="badge bg-info text-dark">${e.department}</span></td>
                    <td class="text-end pe-4 fw-bold">$${e.salary}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    // 3. –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è (POST)
    async function createEmployee() {
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª–µ–π
        let employeeData = {
            firstName: document.getElementById('firstName').value,
            lastName: document.getElementById('lastName').value,
            email: document.getElementById('email').value,
            department: document.getElementById('department').value,
            salary: parseFloat(document.getElementById('salary').value)
        };

        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—á—Ç–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø—É—Å—Ç–æ—Ç—É)
        if(!employeeData.email || !employeeData.firstName) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ò–º—è –∏ Email!");
            return;
        }

        try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
            let response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(employeeData)
            });

            if (response.ok) {
                // –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ:
                // 1. –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ–º Bootstrap API)
                const modalElement = document.getElementById('addEmployeeModal');
                const modalInstance = bootstrap.Modal.getInstance(modalElement);
                modalInstance.hide();
                
                // 2. –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('addEmployeeForm').reset();
                
                // 3. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É (—á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞)
                loadEmployees(); 
            } else {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞! –°—Ç–∞—Ç—É—Å: ' + response.status);
            }
        } catch (error) {
            alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏!');
            console.error(error);
        }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    window.onload = loadEmployees;
</script>

</body>
</html>